const e=(e={})=>{const t={...{}};for(const n of Object.keys(e)){if(n.startsWith("_")){t[n.substring(1)]=e[n]}else{t[n]=e[n]}}return t};const t=(e={})=>{const t={...{}};for(const n of Object.keys(e)){t[n]=e[n]}return t};const n=(e={})=>{const t={...{}};for(const n of Object.keys(e)){t[n]=e[n]}return t};const s="https://arc.dbs.org";const a="https://content.dbs.org";async function o(e){const t={hark:i,dbp:r};for(const n of e.providers){if(t[n]){e.bibles=e.bibles.concat(await t[n]())}}}async function i(e="all",t="all"){const n=await fetch(`${s}/api/bibles`).then((e=>e.json()));let o=await fetch(`${a}/bibles/audio-new/index.txt`).then((e=>e.text()));let i=[];o=o.split("\n");o.forEach((e=>{let t=e.split("_")[0];if(t.includes("-")){t=e.split("-")[0]}for(let s=0;s<n.length;s++){const a=n[s];if(t===a.id){i.push({id:e,abbr:a.id,iso:a.iso,ln:a.ln,tt:a.tt,tv:a.tv,ci:a.ci,cn:a.cn,tp:"hark"});break}}}));if(e!=="all"){i=i.filter((t=>t.ci===e))}if(t!=="all"){i=i.filter((e=>e.id.includes(t)))}return i}async function c(e){const t={"01":"GEN","02":"EXO","03":"LEV","04":"NUM","05":"DEU","06":"JOS","07":"JDG","08":"RUT","09":"1SA",10:"2SA",11:"1KI",12:"2KI",13:"1CH",14:"2CH",15:"EZR",16:"NEH",17:"EST",18:"JOB",19:"PSA",20:"PRO",21:"ECC",22:"SNG",23:"ISA",24:"JER",25:"LAM",26:"EZK",27:"DAN",28:"HOS",29:"JOL",30:"AMO",31:"OBA",32:"JON",33:"MIC",34:"NAM",35:"HAB",36:"ZEP",37:"HAG",38:"ZEC",39:"MAL",40:"MAT",41:"MRK",42:"LUK",43:"JHN",44:"ACT",45:"ROM",46:"1CO",47:"2CO",48:"GAL",49:"EPH",50:"PHP",51:"COL",52:"1TH",53:"2TH",54:"1TI",55:"2TI",56:"TIT",57:"PHM",58:"HEB",59:"JAS",60:"1PE",61:"2PE",62:"1JN",63:"2JN",64:"3JN",65:"JUD",66:"REV"};const n=await fetch(`${a}/bibles/audio-new/${e}/index.txt`);const s=await n.text();const o=new Map;const i=/^\.\/\w+\/(\d+)_(\w+)_(\d+)\.mp3$/;s.split("\n").sort().forEach((e=>{const n=e.match(i);if(n){const[,e,s,a]=n;const i=parseInt(a,10);const c=t[e];if(!o.has(c)){o.set(c,{name:s,book_number:e,book_id:c,chapters:[]})}o.get(c).chapters.push(i)}}));let c=[];const r=await fetch(`${a}/bibles/audio-new/${e}/timingfiles/_index.txt`);if(r.ok){c=(await r.text()).split("\n")}else{console.warn("timing files could not be found")}for(const e of o.values()){e.chapters.sort(((e,t)=>e-t))}return{bible_id:e.split("_")[0],bible_folder:e,timestamps:c,data:Array.from(o.values())}}async function r(e){let t=`https://4.dbt.io/api/bibles?v=4&key=${key}&media=audio`;if(e){t+="&country="+e}bibles=await fetch(t).then((function(e){return e.json()}));let n=bibles.meta.pagination.last_page;let s=1;while(s>=n){s++;results=await fetch(t+"page="+s).then((function(e){return e.json()}));bibles.data.concat(results.data)}return bibles}async function l(e,t){e.query="";const n=await c(t);e.currentBooks=n;const s=e.bibles.find((t=>t.abbr===e.currentBooks.bible_id));e.currentBible=s;const a=new URL(window.location);a.searchParams.set("id",e.currentBible.id);await d(e,n.data[0],1)}async function d(e,t,n){e.currentBook=t;await u(e,t,n)}async function u(e,t,n){e.currentBook=t;let s=n;if(!t?.chapters?.includes(n)){s=1}if(e.currentType==="hark"){const n=t.book_number==="19"?3:2;e.currentChapter={path:`https://content.dbs.org/bibles/audio-new/${e.currentBooks.bible_folder}/${t.book_number}_${t.name}_${s.toString().padStart(n,"0")}.mp3`,title:`${t.name} ${s}`,number:s,book_id:t.book_id,timestamps:[]};e.audio.src=e.currentChapter.path;const a=new URL(window.location);a.searchParams.set("book",t.book_id);a.searchParams.set("c",s);if(Array.isArray(e.currentBooks.timestamps)&&e.currentBooks.timestamps.length>0){const t=/Verse (\d+)	(\d+:\d+:\d+\.\d+)/gm;let n=await fetch(`https://content.dbs.org/bibles/audio-new/${e.currentBooks.bible_folder}/timingfiles/${e.currentBook.book_id}_${s.toString().padStart(3,"0")}.txt`).then((function(e){return e.text()})).catch((e=>{console.error("Error:",e)}));let a=[];let o;while((o=t.exec(n))!==null){o[1];const e=o[2];a.push(e)}e.currentChapter.timestamps=a}}}function p(e,t={}){const n=document.createElement(e);for(const[e,s]of Object.entries(t)){if(e==="style"&&typeof s==="object"){Object.assign(n.style,s)}else{n[e]=s}}return n}function b(e){const t=e/60|0;const n=e%60|0;return`${t}:${n<10?"0":""}${n}`}const h=e=>{const[t,n,s]=e.split(":");return parseInt(t,10)*3600+parseInt(n,10)*60+parseFloat(s)};function m(e){const t=e.options?.playbackRate?.min??.5;const n=e.options?.playbackRate?.max??2.25;const s=e.options?.playbackRate?.step??.25;const a=(t,n)=>{t.className=`${t.baseClassName} ${n?e.class.playbackRate?.disabled:""}`};const o=s=>{e.audio.playbackRate=Math.min(n,Math.max(t,e.audio.playbackRate+s));r.textContent=e.audio.playbackRate.toFixed(2);a(c,e.audio.playbackRate===t);a(l,e.audio.playbackRate===n)};const i=p("div",{className:e.class.playbackRate?.wrapper});const c=p("button",{baseClassName:e.class.playbackRate?.decrease,className:e.class.playbackRate?.decrease,textContent:"-",onclick:()=>o(-s)});const r=p("span",{className:e.class.playbackRate?.display,textContent:e.audio.playbackRate.toFixed(2)});const l=p("button",{baseClassName:e.class.playbackRate?.increase,className:e.class.playbackRate?.increase,textContent:"+",onclick:()=>o(s)});i.append(c,r,l);return i}function k(e){const t=p("div",{className:e.class.volumeRow});const n=p("input",{type:"range",min:"0",max:"1",step:"0.01",className:e.class.volumeInput,id:"volume-control",value:e.audio.volume,"aria-label":"Volume Control"});n.addEventListener("input",(()=>{e.audio.volume=parseFloat(n.value)}));const s=p("label",{htmlFor:"volume-control",className:e.class.volumeLabel,innerHTML:e.icons.volumeIcon});s.appendChild(n);t.appendChild(s);const a=p("button",{className:e.class.sleepTimerButton,innerHTML:e.icons.sleepTimer,"aria-label":"Sleep Timer"});let o=null;let i=0;const c=1*60*1e3;const r=p("span",{className:e.class.sleepTimerDuration,textContent:b(c/1e3),"aria-live":"polite"});a.appendChild(r);a.addEventListener("click",(()=>{if(o){clearInterval(o);o=null;n.value=1;e.audio.volume=1;i=0;l(c)}else{i=0;o=setInterval((()=>{i+=1e3;const t=c-i;const s=t/c;n.value=Math.max(0,s);e.audio.volume=parseFloat(n.value);l(t);if(i>=c){clearInterval(o);o=null;e.audio.pause();l(0)}}),1e3)}}));function l(e){const t=i/c;const n=2*Math.PI*9;r.textContent=b(e/1e3);const s=a.querySelector("svg circle:nth-child(2)");if(s){s.setAttribute("stroke-dashoffset",(1-t)*n)}}t.appendChild(a);return t}function f(e){let t=p("div",{id:`${e.idPrefix}-bible-block`,className:e.class.bibleBlockButtonGroup});const n=[{condition:true,innerHTML:e.icons.bibles,className:e.class.bibleListNavButton,onclick:()=>{e.view="bible";e.render()}},{condition:e.view==="book",innerHTML:e.icons.books,className:e.class.bookListNavButton,onclick:()=>{e.view="chapter";e.render()}},{condition:e.view==="chapter",innerHTML:e.icons.chapters,className:e.class.chapterListNavButton,onclick:()=>{e.view="book";e.render()}}];n.forEach((({condition:e,innerHTML:n,className:s,onclick:a})=>{if(e){t.appendChild(p("button",{innerHTML:n,className:s,onclick:a}))}}));return t}function v(e,t){e.bibleBlock.innerHTML="";e.bibleBlock.className=e.class.bibleBlock;const n=C(e,t);const s=p("div",{className:e.class.selectBookChapterWrap});s.append(g(e),N(e));w(e,s);n.append(f(e));e.bibleBlock.append(n,s);y(e)}function C(e,t){const n=p("div",{className:e.class.bibleBlockInfoWrap});const s=p("div",{className:e.class.bibleBlockLanguageGroup});s.append(p("div",{className:e.class.bibleBlockIso,innerText:t.iso}),p("div",{innerText:t.cn}));n.append(s);const a=p("div",{className:e.class.bibleBlockTitleGroup});a.appendChild(p("div",{className:e.class.bibleBlockTitle,innerText:t.tt}));if(t.tv&&t.tv!==t.tt){a.appendChild(p("div",{className:e.class.bibleBlockVernacular,innerText:t.tv}))}n.appendChild(a);return n}function y(e){const t=e.bookListGrid;t.innerHTML="";if(e.resultsBooks&&e.resultsBooks.length&&e.query!==""){e.resultsBooks.forEach((n=>{t.appendChild(L(e,n.item))}))}else if(e.currentBooks&&e.query===""){if(e.currentBooks["data"]){e.currentBooks["data"].forEach((n=>{t.appendChild(L(e,n))}))}}}function L(e,t){const n=p("button",{className:`${t.book_id} ${e.class.bookListButton} ${e.currentBook.book_id==t.book_id?e.class.bookListButtonActive:""}`,ariaLabel:t.name,onclick:()=>B(e,t.book_id)});n.dataset.bookId=t.book_id;const s=p("div");s.append(p("h2",{className:e.class.bookListTitle,textContent:t.name}),p("h3",{className:e.class.bookListId,textContent:t.book_id}));n.appendChild(s);return n}function B(e,t,n=1){const s=e.currentBooks.data.find((e=>e.book_id===t));if(!s)return;u(s,n);const a=new URL(window.location);a.searchParams.set("bookId",s.book_id);window.history.replaceState({},"",a);e.query="";e.chapterListContainer.style.display="block";e.view="chapter";e.currentBook=s;x(e);v(e,e.currentBible)}function g(e){const t=p("select",{className:e.class.selectBook});if(e.currentBooks&&e.currentBooks.data){e.currentBooks.data.forEach((n=>{const s=p("option",{value:n.book_id,innerText:n.name,selected:n.book_id===e.currentBook.book_id});t.appendChild(s)}))}t.addEventListener("change",(t=>{B(e,t.target.value)}));e.bookSelect=t;return t}function N(e){const t=p("select",{className:e.class.selectChapter});if(e.currentBook&&e.currentBook.chapters){e.currentBook.chapters.forEach((n=>{const s=p("option",{value:n,innerText:n,selected:n==e.currentChapter.number});t.appendChild(s)}))}t.addEventListener("change",(t=>E(e,e.currentBook,parseInt(t.target.value))));e.chapterSelect=t;return t}function w(e,t){if(!e.currentChapter||!e.currentChapter.timestamps||e.currentChapter.timestamps.length==0)return;const n=p("select",{className:e.class.selectVerse});e.currentChapter.timestamps.forEach(((e,t)=>{const s=t+1;const a=p("option",{value:s,innerText:`${s}`});n.appendChild(a)}));n.addEventListener("change",(t=>{const n=parseInt(t.target.value,10);const s=n-1;if(e.currentChapter.timestamps&&e.currentChapter.timestamps[s]){const t=e.currentChapter.timestamps[s];const n=h(t);e.audio.currentTime=n}}));const s=p("div",{innerText:":",className:e.class.selectVerseSeparator});t.append(s,n);e.verseSelect=n;T(e)}function T(e){let t=null;e.audio.addEventListener("timeupdate",(()=>{const n=e.audio.currentTime;const s=e.currentChapter.timestamps;let a=-1;for(let e=0;e<s.length;e++){if(n>=h(s[e])){a=e}else{break}}if(a!==-1&&a!==t){t=a;e.verseSelect.value=a+1}}))}function x(e){e.chapterListContainer.innerHTML="";e.bibleListContainer.style.display="none";e.bookListContainer.style.display="none";e.chapterListContainer.style.display="block";const t=document.createDocumentFragment();e.currentBook.chapters.forEach((n=>{const s=p("button",{className:`${e.class.chapterButton} ${e.currentChapter.number==n?" "+e.class.chapterButtonActive:""}`,ariaLabel:`Play Chapter ${n}`,textContent:n,onclick:()=>E(e,e.currentBook,n)});t.appendChild(s)}));e.chapterListContainer.appendChild(t);if(e.currentBook?.book_id){const t=e.art[e.currentBook.book_id]?.[0];if(!t){console.warn(`No art found for book ID: ${e.currentBook.book_id}`);return}const n=document.createElement("img");n.src=`./img/chars/${t.file}`;n.className=t.class;e.chapterListContainer.appendChild(n)}}function E(e,t,n){u(e,t,n);e.chapterSelect.value=n;e.audio.play();const s=document.querySelector(`.icon-play`);s.innerHTML=e.audio.paused?e.icons.play:e.icons.pause;x(e)}function $(e){function t(e,t,n){const s=n.getBoundingClientRect();const a=(e.clientX-s.left)/s.width;t.audio.currentTime=Math.max(0,Math.min(a,1))*t.audio.duration}const n=p("div",{className:e.class?.progress?.container});const s=p("div",{id:"currentTime",className:e.class?.progress?.currentTimeDisplay,textContent:b(e.audio.currentTime)});const a=p("div",{id:"progress-wrapper",className:e.class?.progress?.wrapper});const o=p("div",{id:"progress-bar",className:e.class?.progress?.barInner,style:{width:"0%"}});const i=p("div",{id:"timestamps-wrapper",className:e.class?.progress?.timestamps});const c=p("div",{className:e.class?.progress?.circleTip,style:{left:"0%"}});a.append(o,c);const r=n=>{if(e.isDragging){t(n,e,a)}};const l=()=>{if(e.isDragging){e.isDragging=false;document.body.style.userSelect="";document.removeEventListener("mousemove",r);document.removeEventListener("mouseup",l)}};a.addEventListener("mousedown",(()=>{e.isDragging=true;document.body.style.userSelect="none";document.addEventListener("mousemove",r);document.addEventListener("mouseup",l)}));a.addEventListener("click",(n=>{t(n,e,a)}));const d=p("div",{className:e.class?.progress?.durationDisplay,textContent:b(e.audio.duration||0)});e.audio.addEventListener("timeupdate",(()=>{const t=e.audio.currentTime/e.audio.duration*100;o.style.width=`${t}%`;c.style.left=`calc(${t}% - 3px)`;s.textContent=b(e.audio.currentTime)}));e.audio.addEventListener("loadedmetadata",(()=>{i.innerHTML="";d.textContent=b(e.audio.duration);if(e.currentChapter.timestamps&&Array.isArray(e.currentChapter.timestamps)){e.currentChapter.timestamps.forEach((t=>{const n=h(t);if(n<=e.audio.duration&&n>=0){const t=n/e.audio.duration*100;const s=p("div",{className:`progress-tick ${e?.class?.progress?.tick}`,style:{left:`${t}%`}});i.appendChild(s)}}))}}));a.append(i);n.append(s,a,d);return n}function _(e){const t=p("div",{className:e.class.navRow});t.append(I(e,"prev"),H(e,"prev"),S(e,"prev"),M(e),S(e,"next"),H(e,"next"),I(e,"next"));const n=p("div",{className:e.class.controlsContainer});n.append($(e),m(e),t,k(e));return n}function M(e){const t=p("button",{className:e.class.playPauseButton,onclick:()=>e.audio.paused?e.audio.play():e.audio.pause()});const n=p("span",{className:e.class.playPauseIcon,innerHTML:e.icons.play});t.appendChild(n);e.audio.addEventListener("play",(()=>{n.innerHTML=e.icons.pause}));e.audio.addEventListener("pause",(()=>{n.innerHTML=e.icons.play}));return t}function I(e,t){return p("button",{className:e.class[`${t}BookButton`],innerHTML:e.icons[`${t}Book`],onclick:()=>{const n=e.currentBooks.data.findIndex((t=>t.book_id===e.currentBook.book_id));const s=t==="prev"?n-1:n+1;if(e.currentBooks.data[s]){B(e,e.currentBooks.data[s].book_id);E(e,e.currentBooks.data[s],1)}}})}function H(e,t){return p("button",{className:e.class[`${t}ChapterButton`],innerHTML:e.icons[`${t}Chapter`],onclick:()=>R(e,t)})}async function R(e,t){const n=t==="prev"?-1:1;const s=e.currentChapter.number+n;const a=t==="prev"?s>0:s<e.currentBook.chapters.length+1;if(a){E(e,e.currentBook,s);return}const o=e.currentBooks.data.findIndex((t=>t.book_id===e.currentBook.book_id));const i=o+n;const c=e.currentBooks.data[i];if(c){B(e,c.book_id);E(e,c,1)}}function S(e,t){return p("button",{id:`${t}SkipButton`,className:e.class[`${t}SkipButton`],innerHTML:e.icons[`${t}Skip`],onclick:()=>{e.audio.currentTime+(t=="next"?15:-15);e.audio.currentTime=Math.min(Math.max(e.audio.currentTime,0),e.audio.duration)}})}function A(e,t,n){const s=e.toLowerCase();const a=.9;const o=.5;const i=Math.max(o,a-(s.length>10?.15:s.length*.05));return t.reduce(((e,t)=>{let a=0;let o=0;n.forEach((e=>{if(t[e]){const n=t[e].toString().toLowerCase();const c=P(s,n);const r=c/Math.max(s.length,n.length);if(r<=i){a+=r;o++}}}));if(o>0){e.push({item:t,score:a/o})}return e}),[]).sort(((e,t)=>e.score-t.score))}function P(e,t){if(e===t)return 0;const n=Array.from({length:e.length+1},((e,t)=>t));for(let s=1;s<=t.length;s++){let a=n[0];n[0]=s;for(let o=1;o<=e.length;o++){const i=n[o];n[o]=Math.min(n[o]+1,n[o-1]+1,a+(e[o-1]!==t[s-1]));a=i}}return n[e.length]}function O(e){e.bibleListContainer.innerHTML="";const t=p("div",{className:e.class.searchWrapper});const n=p("input",{type:"search",placeholder:"Filter Audio Bibles",autocomplete:"off",className:e.class.searchInput,oninput:()=>{e.query=n.value;e.results=A(e.query,e.bibles,["tt","tv","ln"]);D(e)}});n.setAttribute("aria-label","Search");t.appendChild(n);e.bibleListContainer.appendChild(t);const s=p("div",{className:e.class.bibleListGrid});e.bibleListGrid=s;e.bibleListContainer.appendChild(s);D(e)}function D(e){const t=e.bibleListGrid;t.innerHTML="";const n=e.query?e.results.map((e=>e.item)):e.bibles;const s=document.createDocumentFragment();n.forEach((t=>s.appendChild(G(e,t))));t.appendChild(s)}function G(e,t){const n=p("button",{className:e.class.bibleButton.wrapper,onclick:()=>q(e,t)});n.dataset.testId=t.id;n.setAttribute("aria-label",t.tv??t.tt);const s=p("div",{className:e.class.bibleButton.languageWrap});s.appendChild(p("h2",{className:e.class.bibleButton.language,textContent:t.ln}));s.appendChild(p("small",{className:e.class.bibleButton.iso,textContent:t.iso}));const a=p("div",{className:e.class.bibleButton.titleWrap});a.appendChild(p("h4",{className:e.class.bibleButton.title,textContent:t.tt}));if(t.tt!==t.tv&&t.tv){const n=p("p",{className:e.class.bibleButton.vernacular,textContent:t.tv});a.appendChild(n)}n.appendChild(s);n.appendChild(a);return n}async function q(e,t){if(t.tp==="hark"){e.view="book";e.currentBible=t;await l(e,t.id);v(e,t);e.render();const n=new URL(window.location);n.searchParams.set("bibleId",t.id);window.history.replaceState({},"",n)}else if(t.tp==="dbl");}function J(e){const t=p("input",{type:"search",placeholder:e.i18n?.filter_books??"Filter Books",className:e.class.searchInput,ariaLabel:"search",autocomplete:"off",oninput:()=>{e.query=t.value;console.log(t.value,e.currentBooks.data);e.resultsBooks=A(e.query,e.currentBooks.data,["name"]);y(e)}});const n=p("div",{className:e.class.searchInputContainer});n.appendChild(t);e.bookListContainer.appendChild(n);e.bookListContainer.appendChild(e.bookListGrid=p("div",{className:e.class.bookListGrid}));y(e)}class j{constructor(s,a){this.container=document.getElementById(s);this.providers=a.providers??["hark"];this.bibles=[];this.currentBible={};this.currentBooks=[];this.currentBook={};this.currentChapter={number:0};this.audio=document.createElement("audio");this.currentType="hark";this.isDragging=false;this.class=e(a.classes);this.icons=t(a.icons);this.art=n(a.art);this.results=[];this.query="";this.view="bible";this.idPrefix=a?.idPrefix??"audio-player";this.views={bible:{player:"none",bibleListContainer:"block",bookListContainer:"none",chapterListContainer:"none"},book:{player:"block",bibleListContainer:"none",bookListContainer:"block",chapterListContainer:"none"},chapter:{player:"block",bibleListContainer:"none",bookListContainer:"none",chapterListContainer:"block"}}}static async create(e,t){const n=new j(e,t);await o(n);n.container.innerHTML="";const s=n.idPrefix;const a=p("div",{id:`${s}-player-container`,className:n.class.playerContainer});n.bibleListContainer=p("div",{id:`${s}-bible-list-container`,className:n.class.bibleListContainer});n.bookListContainer=p("div",{id:`${s}-book-list-container`,className:n.class.bookListContainer});n.chapterListContainer=p("div",{id:`${s}-chapter-list-container`,className:n.class.chapterListContainer});n.bibleBlock=p("div",{id:`${s}-bible-block`,className:n.class.bibleBlock});n.player=U(n);a.append(n.bibleBlock,n.audio,n.player);J(n);a.append(n.bookListContainer,n.chapterListContainer,n.bibleListContainer);n.container.appendChild(a);this.setDefaultView(n);return n}static async setDefaultView(e){const t=new URL(window.location);if(t.searchParams.get("bibleId")){await q(e,e.bibles.find((e=>e.id==t.searchParams.get("bibleId"))));e.view="book"}if(t.searchParams.get("bookId")){await B(e,t.searchParams.get("bookId"));e.view="chapter"}if(e.view==="bible"){O(e)}F(e)}render(){if(this.view==="bible"){O(this)}else if(this.view==="book"){y(this)}else if(this.view==="chapter"){chapterList(this)}F(this)}setData(e){Object.assign(this,e)}}function F(e){const t=e.views[e.view]||views.bible;e.player.style.display=t.player;e.bibleListContainer.style.display=t.bibleListContainer;e.bookListContainer.style.display=t.bookListContainer;e.chapterListContainer.style.display=t.chapterListContainer}function U(e){const t=p("div",{id:"media-player-wrap",className:e.class.mediaPlayerWrap});const n=_(e);t.appendChild(n);return t}export{j as default};
//# sourceMappingURL=AudioPlayer.NoDefaults.min.js.map
